{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ridewire.ai/schemas/revenue-event.json",
  "title": "Revenue Event Schema",
  "description": "Transaction events for subscriptions, marketplace sales, and revenue tracking",
  "type": "object",
  "required": ["event_id", "user_id", "timestamp", "event_type", "amount", "currency", "status"],
  "properties": {
    "event_id": {
      "type": "string",
      "description": "Unique revenue event identifier",
      "pattern": "^REV-[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]+$",
      "example": "REV-2025-12-20-5821"
    },
    "user_id": {
      "type": "string",
      "description": "User associated with this revenue event",
      "pattern": "^USER-[0-9]+$",
      "example": "USER-5892"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the transaction occurred",
      "example": "2025-12-20T14:32:18Z"
    },
    "event_type": {
      "type": "string",
      "enum": ["subscription_purchase", "subscription_renewal", "subscription_cancel", "marketplace_sale", "diagram_purchase", "refund", "chargeback"],
      "description": "Type of revenue event",
      "example": "marketplace_sale"
    },
    "amount": {
      "type": "number",
      "description": "Transaction amount (gross)",
      "minimum": 0,
      "example": 9.99
    },
    "net_amount": {
      "type": "number",
      "description": "Net amount after fees",
      "minimum": 0,
      "example": 6.99
    },
    "currency": {
      "type": "string",
      "description": "ISO 4217 currency code",
      "pattern": "^[A-Z]{3}$",
      "example": "USD"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "completed", "failed", "refunded", "disputed"],
      "description": "Transaction status",
      "example": "completed"
    },
    "subscription": {
      "type": "object",
      "description": "Subscription details (if applicable)",
      "properties": {
        "subscription_id": {
          "type": "string",
          "description": "Stripe/payment provider subscription ID",
          "example": "sub_1QLx3t2eZvKYlo2CqT8s9RWX"
        },
        "tier": {
          "type": "string",
          "enum": ["free", "pro", "enterprise"],
          "description": "Subscription tier",
          "example": "pro"
        },
        "billing_cycle": {
          "type": "string",
          "enum": ["monthly", "annual"],
          "description": "Billing frequency",
          "example": "monthly"
        },
        "start_date": {
          "type": "string",
          "format": "date-time",
          "description": "Subscription start date",
          "example": "2025-12-01T00:00:00Z"
        },
        "end_date": {
          "type": "string",
          "format": "date-time",
          "description": "Subscription end date",
          "example": "2026-01-01T00:00:00Z"
        },
        "auto_renew": {
          "type": "boolean",
          "description": "Will subscription auto-renew?",
          "example": true
        }
      }
    },
    "marketplace": {
      "type": "object",
      "description": "Marketplace transaction details (if applicable)",
      "properties": {
        "product_id": {
          "type": "string",
          "description": "Product/diagram ID",
          "pattern": "^PROD-[A-Z0-9]+$",
          "example": "PROD-DIAG-4521"
        },
        "product_name": {
          "type": "string",
          "description": "Product name",
          "example": "P0300 Spark Plug Wire Diagram - Harley Street 750"
        },
        "seller_id": {
          "type": "string",
          "description": "User who created/sold the product",
          "pattern": "^USER-[0-9]+$",
          "example": "USER-3142"
        },
        "buyer_id": {
          "type": "string",
          "description": "User who purchased the product",
          "pattern": "^USER-[0-9]+$",
          "example": "USER-5892"
        },
        "platform_fee": {
          "type": "number",
          "description": "RideWire platform fee (30%)",
          "example": 3.00
        },
        "seller_payout": {
          "type": "number",
          "description": "Amount paid to seller (70%)",
          "example": 6.99
        }
      }
    },
    "payment_method": {
      "type": "object",
      "description": "Payment method details",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["credit_card", "debit_card", "paypal", "apple_pay", "google_pay", "other"],
          "description": "Payment method type",
          "example": "credit_card"
        },
        "last4": {
          "type": "string",
          "description": "Last 4 digits of card (if applicable)",
          "pattern": "^[0-9]{4}$",
          "example": "4242"
        },
        "brand": {
          "type": "string",
          "description": "Card brand (if applicable)",
          "enum": ["visa", "mastercard", "amex", "discover", "other"],
          "example": "visa"
        }
      }
    },
    "stripe": {
      "type": "object",
      "description": "Stripe-specific metadata",
      "properties": {
        "charge_id": {
          "type": "string",
          "description": "Stripe charge ID",
          "example": "ch_3QLx3t2eZvKYlo2C0123456"
        },
        "payment_intent_id": {
          "type": "string",
          "description": "Stripe payment intent ID",
          "example": "pi_3QLx3t2eZvKYlo2C0123456"
        },
        "invoice_id": {
          "type": "string",
          "description": "Stripe invoice ID (for subscriptions)",
          "example": "in_1QLx3t2eZvKYlo2CqT8s9RWX"
        }
      }
    },
    "refund": {
      "type": "object",
      "description": "Refund details (if applicable)",
      "properties": {
        "refund_id": {
          "type": "string",
          "description": "Refund transaction ID",
          "example": "REF-2025-12-21-0042"
        },
        "refund_amount": {
          "type": "number",
          "description": "Refund amount",
          "example": 9.99
        },
        "refund_reason": {
          "type": "string",
          "enum": ["customer_request", "fraudulent", "duplicate", "other"],
          "description": "Reason for refund",
          "example": "customer_request"
        },
        "refunded_at": {
          "type": "string",
          "format": "date-time",
          "description": "When refund was processed",
          "example": "2025-12-21T10:15:00Z"
        }
      }
    },
    "xp_earned": {
      "type": "integer",
      "description": "XP awarded for this transaction (seller only)",
      "minimum": 0,
      "example": 50
    },
    "achievements_unlocked": {
      "type": "array",
      "description": "Achievements unlocked by this transaction",
      "items": {
        "type": "string",
        "pattern": "^ACH-[A-Z0-9]+$"
      },
      "example": ["ACH-FIRST-SALE"]
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "utm_source": {
          "type": "string",
          "description": "Traffic source (for attribution)",
          "example": "chrisfix"
        },
        "utm_campaign": {
          "type": "string",
          "description": "Campaign name",
          "example": "youtube_q4_2025"
        },
        "referrer": {
          "type": "string",
          "description": "Referring URL",
          "example": "https://www.youtube.com/watch?v=xyz123"
        }
      }
    }
  }
}
